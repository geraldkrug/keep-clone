name: Build Android AAB

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Decode keystore
        run: |
          echo "${{ MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCLDKZqJpIjCnyAgRZe+Z+llMc77q8sz6Gev3RkPJfchidtl+H7+zYDNcBPSAnaPE9pGVivYUj3WNJKX7eGX6ZxU/dskOKuNMtGhM5qZVE89RCMvUUrkQ2RSCwZshU7PZXyiQoFr+NmdqA4qppQj6yJLcvIkihE0hVv8nw+W7eDKA65FR7KdsEDktcxZcQppD2/G1D7ZXkroxFx32DMOfBqVUDKo/1bHYyfccI57B1zgTIb6nMyAwcCHqAV/K6nCJ06fwB0tM0ItOT7wzBsSBZQ+Zb7dBrtLd7vQ24NEcH6fOlmk/dfpGqiQ140GYqRfryhmd5jLc7lB9dUPpDxnt1TAgMBAAECggEAFSXh45AlNsYgBG1dqSk/EjBsEt3s75xOoPXObnZWxHf05DKu8KOW5esVahlzQildDIeJ2ParYc81AJHJOFsw1dim73CjwUoPRpTpTf5F2kcNctJQhF1F2nxHFMtkdkOaHC6igxXquIk/Og8cdDc9zwlTjphIHptzHjkbk2JgqUZDcxRZs8+eGFhBXWSi1t6UxnIYhkQ3q0suGh+9woYnNFBR9OPUf6crVTCzznpRy2AFTMZ5diFBEH7pL+cjXBfbXXDM4h1I/+UaQdOto2Rr/Pum32q96v03BDUnSiZP87WMHk0TKEj5kFL2es68+lXog9+JBref3hwUsYCu35WHfQKBgQDEa804SRNXVKn68Fenrg5otyHnTir4gDZBey91WA9rvXBzrWLJIQnBgRcaSyQFI4tSkkhpoasBUjNIyGJxPnLk1uMtNl4YUqa0eERfJrm2hOiflSq/xn69D203+quLIx6lqNHW6A7YADZJdsuKu9ejggAtiaFSa0RF3/ILQFEhrwKBgQC1Oehm6yua5MwgxhhxYRuP8SHTlgRtfyNFOf6nyKq8tGfRig4sfx9+HDv9cPR+pKTCotjaRyPxqRaPxeVBKkv/N2qBLJZLlYZR7f5ZggN0k9dwaxYfLJ0Tooak1j73nvEQG8fRGJCbXtzJzQ5PUrIU53R6YarUPi362CI80lxbnQKBgChnaHKAjar0LncBA3bplesyaJX0/V/at85mcY+4yotGD6Cr9Nscoa4dSMxO0pz//8O/dYfNCqkd6JC7L4zN5MJv9ZEyUs68CbCr4JyWEbOayWMyQvXp9d4cE0JlnO3lDoPTIz8KwyrpeEFKX3otQ6FNt42mdvnGOOgKtfZch5PfAoGBAI9EgkeqrsQ7EGzwbi5j2IhI1rcQp9twYQ+/M2StLN0VueVbQK1IqjrmUz6e54qe2mnMl6aoCvBm/iEXD5Aewgm3Y4lPGFoUkSWAAk38jILCxdRntAtdF6iIGe2COjFEA8r6S1MwGlHaAq2+YAuxknsYJ2sAfy5fIbZm21o96ym5AoGBALerU/iEb1v+7r7NE3lEpaY+ifD1/2OOCknLVQxWUzIvcfpGKTgMJ5xM8PoaBeIxHwU0dqznFvvIkuIyJoU4dcxAkrELjIB5eQBAvScmDg5DTY8bE/pD8wRj4N8xCbGGRrtc08gDiSL2dc7pGC72v2l56/6IXhpMEQqcZQjgnD9P }}" | base64 --decode > keepclone.keystore

      - name: Grant Gradle permission
        run: chmod +x ./gradlew

      - name: Build signed release AAB
        env:
          KEYSTORE_PASSWORD: ${{ Heaven12## }}
          KEY_PASSWORD: ${{ Heaven12## }}
          KEY_ALIAS: ${{ keepclone }}
        run: ./gradlew bundleRelease

      - name: Upload AAB artifact
        uses: actions/upload-artifact@v4
        with:
          name: app-release-aab
          path: app/build/outputs/bundle/release/app-release.aab
